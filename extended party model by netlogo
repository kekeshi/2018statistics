代码复现和解说netlogo——model library——party，并通过增加了tolerance的attributes(group size & race)对模型做了拓展。
链接：https://pan.baidu.com/s/1vMDwBZeUoCK5ZNIglu5rLg  提取码：op4i 

创建变量
globals [    ;;创建全局变量
  group-sites   ;; agentset of patches where groups are located
  boring-groups  ;; how many groups are currently single-sex
]

turtles-own [    ;;定义属于每个海龟的变量
  happy?         ;; true or false 快乐与否
  my-group-site  所属的组
]

设置总体流程
to setup
  clear-all  全局变量清0
  set group-sites patches with [group-site?]
  set-default-shape turtles "person"  ;;海龟形状定义为人形
  create-turtles number [        ;; 给新海龟执行的命令
    choose-sex                   ;; 设置性别
    choose-race                  ;; 设置种族
    set size 3                   ;; 设置图标大小
    set my-group-site one-of group-sites ;;将海龟的变量设置为全局变量中的一个
    move-to my-group-site                ;;移动海龟
  ]
  ask turtles [ update-happiness ]  ;;更新happiness属性
  count-boring-groups               ;;数单性别的组数
  update-labels                     ;;更新标签
  ask turtles [ spread-out-vertically ]  ;;男女分开站
  reset-ticks                            ;;时钟计数器重设为0
end

to go
  if all? turtles [happy?]    all? agentset [reporter] 主体集合中的reporter都是返回true，就返回true，否则返回false
    [ stop ]                                          ;; 大家都开心了，终止
  ask turtles [ move-to my-group-site ]  ;; put all people back to their group sites 把人移动他的组里去
  ask turtles [ update-happiness ]    ;;更新开心属性
  ask turtles [ leave-if-unhappy ]    ;;不开心就走
  find-new-groups
  update-labels
  count-boring-groups
  ask turtles [
    set my-group-site patch-here  patch-here 
    spread-out-vertically
  ]
  tick
end

检查一下大家开心吗？
to update-happiness  ;; turtle procedure
  let total count turtles-here  ;;turtles-here返回位于调用者瓦片上的所有海龟组成的主体集合（如果调用者是海龟，则也包括它），这句创建total数一组里的海龟数
  let same count turtles-here with [color = [color] of myself]   ;;数数颜色相同的海龟数
  let opposite (total - same)  ;;颜色/性别不同的个数是总数减去同色组
  ;; you are happy if the proportion of people of the opposite sex
  ;; does not exceed your tolerance
  set happy? (opposite / total) <= (tolerance / 100)  and (oppositerace / total) <= (tolerance / 100) 将变量设为不同色占总数比小于等于容忍度
end

不满意就离开
to leave-if-unhappy  ;; turtle procedure
  if not happy? [
    set heading one-of [90 270]  ;; randomly face right or left  heading指明海龟面向的方向，90度或270度，相当于向左向右
    fd 1                         ;; leave old group  前进一步，对应到to go 里的寻找新组
  ]
end

to find-new-groups
  display   ;; force display update so we see animation  ;;视图立即更新
  let malcontents turtles with [not member? patch-here group-sites]
  if not any? malcontents [ stop ]
  ask malcontents [ fd 1 ]
  find-new-groups
end

组的等位设置
to-report group-site?  ;;开始一个报告期历程，返回一直值
  let group-interval floor (world-width / num-groups)  ;;相当于定义了一个组间宽的变量，计算方法是求取—— floor返回小于等于世界总宽度/总组数的最大整数
  report
    ;; all group sites are in the middle row   
    (pycor = 0) and   ;; y坐标为0，就是要在中间
    ;; leave a right margin of one patch, for legibility
    (pxcor <= 0) and  ;;x坐标<=0，只展现左边部分
    ;; the distance between groups must divide evenly into
    ;; our pxcor
    (pxcor mod group-interval = 0) and    ;;A mod B 返回A/B的余数，x坐标能够整除组间距，就是让组间距离平均
    ;; finally, make sure we don't wind up with too many groups
    (floor ((- pxcor) / group-interval) < num-groups)   ;;组数不要超过设置的组数

男女分开站
to spread-out-vertically  ;; turtle procedure
  ifelse woman?
    [ set heading 180 ]  ;; face south  ;;女的，朝向180度，就是在下方
    [ set heading   0 ]  ;; face north  ;;男的，朝向0度，在上方，
  fd 4                   ;; leave a gap
  while [any? other turtles-here] [
    if-else can-move? 2 [
      fd 1
    ]
    [ ;; else, if we reached the edge of the screen
      set xcor xcor - 1  ;; take a step to the left
      set ycor 0         ;; and move to the base a new stack
      fd 4
    ]
  ]
end

to count-boring-groups
  ask group-sites [
    ifelse boring?
      [ set plabel-color gray  ]   plabel是一个内置瓦片变量，可以保存任何类型的值，与瓦片附着在一起，显示在视图中
      [ set plabel-color white ]
  ]
  set boring-groups count group-sites with [plabel-color = gray]  设置boring-groups是单性别的组数
end

to-report boring?  ;; patch procedure
  report length remove-duplicates ([color] of turtles-here) = 1 remove-replicates 
  ;;去除重复项，保留第一个。如果去除重复项后只剩下一种颜色，说明只有一个性别。
end

to update-labels
  ask group-sites [ set plabel count turtles-here ]
end

设置性别
to choose-sex  ;; turtle procedure
  set color one-of [pink blue]
end

to-report woman?  ;; turtle procedure
  report color = pink
end

设置种族
to choose-race
  set label one-of [0 1]
end

to-report race?
  report label = 0
end
